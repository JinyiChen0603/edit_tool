---
id: 258
title: Enumeration of Iso-Parity Partial Injections on Derived Index Sets
question_type: 数学
domain: 高中数学竞赛组合
difficulty: 中学
knowledge_point: \begin{itemize}
batch: 01_第一批100题
teacher: xieshuhong
---

## 题目
Let $\mathcal{M}{a,b,c}$ be a circulant matrix defined by non-negative integers $a, b, c$ as follows:
$$
\mathcal{M}{a,b,c} = \begin{pmatrix}
a & b & c 
c & a & b 
b & c & a
\end{pmatrix}
$$
Let set $X$ be the set of all possible values of the determinant of this matrix:
$$ X = { \det(\mathcal{M}_{a,b,c}) \mid a, b, c \in \mathbb{N}_0 } $$
Let set $Y$ be the set of integers defined by the product of three non-negative integers with the same parity:
$$ Y = { uvw \mid u, v, w \in \mathbb{N}_0 \text{ and } u \equiv v \equiv w \pmod 2 } $$
Define set $P = { n \mid n \in X \cap Y, \ 1 \le n \le 2016 }$.
Calculate the cardinality of set $P$ (i.e., the number of elements in $P$).

## 解答
Here the key is to understand exactly which integers can occur as
$$
\det(\mathcal M_{a,b,c}),
$$
and then intersect that description with the much simpler parity-product set (Y). Once those two characterizations are in hand, the counting up to (2016) becomes a clean inclusion–exclusion exercise.

A standard formula for a (3\times 3) circulant determinant gives
$$
\det(\mathcal M_{a,b,c})=(a+b+c),(a^2+b^2+c^2-ab-bc-ca).
$$
Let
$$
s=a+b+c,\qquad q=a^2+b^2+c^2-ab-bc-ca.
$$
So (\det = s,q), with (s,q\in\mathbb N_0).
Key congruence fact (mod 3)
Rewrite (q) using differences. Let
$$
x=a-b,\qquad y=a-c.
$$
Then one checks
$$
q=x^2-xy+y^2.
$$
Working mod (3), note that in (\mathbb F_3),
$$
x^2-xy+y^2 \equiv (x-2y)^2 \pmod 3,
$$
so
$$
3\mid q \iff x\equiv 2y \pmod 3 \iff x+y\equiv 0\pmod 3.
$$
Also,
$$
s=a+b+c=3a-x-y \equiv -(x+y)\pmod 3.
$$
Therefore:

(3\mid q \iff x+y\equiv 0\pmod 3 \iff 3\mid s).

So (3\mid q) happens exactly when (3\mid s), and hence:

If (3\mid \det=sq), then in fact (3\mid s) and (3\mid q), so (9\mid \det).

Equivalently,
$$
v_3(\det)\neq 1.
$$
So (X) contains no integers with exactly one factor of 3.
Converse (all others do occur)

If (3\nmid n): choose ((a,b,c)=(t,t,t-1)) with (t\ge 1). Then (q=1) and (\det=3t-1), giving all residues (\equiv 2\pmod 3) not divisible by 3; similarly ((t,t,t-2)) gives (\equiv 1\pmod 3). So every (n) with (3\nmid n) is achievable.
If (9\mid n): choose ((a,b,c)=(t,t-1,t+1)). Then (s=3t), (q=3), so (\det=9t), giving all multiples of (9).

Thus:
$$
X={n\in\mathbb N_0:\ v_3(n)\neq 1}.
$$


If (u\equiv v\equiv w\pmod 2), then either:

all are odd (\Rightarrow uvw) is odd, or
all are even (\Rightarrow uvw) is divisible by (2^3=8).

So for positive integers,
$$
Y\cap{1,2,\dots}={\text{odd integers}}\ \cup\ { \text{multiples of }8}.
$$


We need integers (n\in[1,2016]) such that:

(n) is odd or (8\mid n), and
(v_3(n)\neq 1) (i.e., not divisible by 3 but not by 9).

These two parts (“odd” and “multiple of 8”) are disjoint, so we count separately and add.

A) Odd (n\le 2016) with (v_3(n)\neq 1)
Number of odd integers up to (2016):
$$
1008.
$$
Among them, those with (v_3(n)=1) are odd multiples of 3 that are not multiples of 9.

Odd multiples of (3) up to (2016): total multiples of 3 is (672); even multiples are multiples of 6, i.e. (336). So odd multiples of 3: (672-336=336).
Odd multiples of (9): total multiples of 9 is (224); even multiples are multiples of 18, i.e. (112). So odd multiples of 9: (224-112=112).

Thus odd numbers with (v_3=1): (336-112=224).
So odd numbers in (X): (1008-224=784).

B) Multiples of 8 up to (2016) with (v_3(n)\neq 1)
Count multiples of 8:
$$
\left\lfloor\frac{2016}{8}\right\rfloor=252.
$$
Write (n=8m). Since (3\nmid 8), we have (v_3(n)=v_3(m)).
So we exclude those (m\le 252) with (v_3(m)=1), i.e. multiples of 3 but not 9:

Multiples of 3 up to 252: (84).
Multiples of 9 up to 252: (28).

So (v_3=1) count is (84-28=56). Hence acceptable multiples of 8: (252-56=196).


Add the two disjoint counts:
$$
|P|=784+196=980.
$$
Cardinality of (P): (\boxed{980}).

## 答案
980
