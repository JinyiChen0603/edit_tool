---
id: 225
title: 素数桥接路径问题
question_type: 数学
domain: 高中数学竞赛组合
difficulty: 中学
knowledge_point: 图论，谱图理论，包含-排除原理，素数性质
batch: 01_第一批100题
teacher: zhujinhong
---

## 题目
Problem: The Surjective Prime-Bridge Walk

Category: Spectral Graph Theory / Inclusion-Exclusion

Definitions:
Let $V = \{1, 2, 3, 4, 5, 6\}$ be the set of available digits.
We define a directed graph $G = (V, E)$ where a transition from digit $u$ to digit $v$ is valid (denoted $u \to v$) if and only if their sum is a prime number:
$$ (u, v) \in E \iff (u + v) \in \{2, 3, 5, 7, 11\} $$
(Note: $u$ and $v$ can be the same digit if $2u$ is prime, e.g., $1+1=2$. However, we assume standard digits distinctness for adjacency is NOT required unless specified. In this problem, self-loops are allowed if the sum condition is met).

The Sequence:
We consider sequences of length $n=8$, denoted as $S = (d_1, d_2, \dots, d_8)$, where each $d_i \in V$.

Constraints:
A sequence $S$ is valid if it satisfies all of the following:

Prime-Bridge Connectivity:
Every pair of adjacent digits must satisfy the graph transition rule.
$$ \forall i \in \{1, \dots, 7\}, \ (d_i + d_{i+1}) \in \mathbb{P} \text{ (The set of primes)} $$

Boundary Condition:
The sequence must start with digit 1 and end with digit 6.
$$ d_1 = 1, \quad d_8 = 6 $$

Surjectivity (The Hard Constraint):
The sequence must contain every digit from the set $V$ at least once.
$$ \{d_1, d_2, \dots, d_8\} = \{1, 2, 3, 4, 5, 6\} $$

Question:
Calculate the total number of such valid sequences.

## 解答
\textbf{Solution (Inclusion--Exclusion + adjacency matrices).}

Let \(V=\{1,2,3,4,5,6\}\).  Define a directed edge \(u\to v\) iff
\(u+v\in\{2,3,5,7,11\}\).  (Self-loops are allowed; here the only loop is
\(1\to 1\) since \(1+1=2\) is prime.)

\medskip
\textbf{1) Adjacency.}
From the prime-sum rule we obtain the outgoing neighbors:
\[
\begin{aligned}
1&\to \{1,2,4,6\},\\
2&\to \{1,3,5\},\\
3&\to \{2,4\},\\
4&\to \{1,3\},\\
5&\to \{2,6\},\\
6&\to \{1,5\}.
\end{aligned}
\]
Let \(A\) be the \(6\times 6\) adjacency matrix indexed by \(1,2,3,4,5,6\),
i.e. \(A_{uv}=1\) if \(u\to v\) and \(0\) otherwise.  Then the number of
length-\(7\) directed walks from \(1\) to \(6\) (equivalently, sequences
\((d_1,\dots,d_8)\) with \(d_1=1,d_8=6\)) is
\[
(A^7)_{1,6}.
\]
A direct computation (seven matrix multiplications, or powering by squaring)
gives
\[
(A^7)_{1,6}=289.
\tag{1}
\]

\medskip
\textbf{2) Enforcing surjectivity by Inclusion--Exclusion.}
Because \(d_1=1\) and \(d_8=6\), digits \(1\) and \(6\) already appear.
Thus surjectivity is equivalent to requiring that each of \(\{2,3,4,5\}\)
appears at least once.

For any subset \(U\subseteq\{2,3,4,5\}\), let \(A_U\) denote the adjacency
matrix of the \emph{induced} directed graph on \(V\setminus U\) (i.e. we forbid
all digits in \(U\)).  Let
\[
N(U):=(A_U^7)_{1,6},
\]
the number of admissible sequences of length \(8\) from \(1\) to \(6\)
that avoid every digit in \(U\).  By Inclusion--Exclusion, the number of
surjective sequences is
\[
N_{\text{surj}}
=\sum_{U\subseteq\{2,3,4,5\}}(-1)^{|U|}N(U).
\tag{2}
\]

It remains to compute the \(16\) values \(N(U)\).  Each \(N(U)\) is again
an entry of the 7th power of a matrix of size \(6-|U|\), so it is a finite,
routine computation.  The resulting values are:

\[
\begin{array}{c|c}
U & N(U)=(A_U^7)_{1,6}\\ \hline
\varnothing & 289\\
\{2\} & 76\\
\{3\} & 211\\
\{4\} & 151\\
\{5\} & 141\\ \hline
\{2,3\} & 67\\
\{2,4\} & 28\\
\{2,5\} & 51\\
\{3,4\} & 129\\
\{3,5\} & 97\\
\{4,5\} & 51\\ \hline
\{2,3,4\} & 28\\
\{2,3,5\} & 43\\
\{2,4,5\} & 13\\
\{3,4,5\} & 43\\ \hline
\{2,3,4,5\} & 13
\end{array}
\]

Now substitute these into \((2)\):
\[
\begin{aligned}
N_{\text{surj}}
&=289-(76+211+151+141)\\
&\quad +(67+28+51+129+97+51)\\
&\quad -(28+43+13+43)+13\\
&=289-579+423-127+13\\
&=19.
\end{aligned}
\]

\[
\boxed{19}
\]

\textbf{Therefore, there are exactly \(\boxed{19}\) valid sequences of length \(8\)
starting with \(1\), ending with \(6\), obeying the prime-bridge rule, and using
all digits \(1,2,3,4,5,6\) at least once.}

## 答案
$$19$$

