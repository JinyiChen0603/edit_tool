---
id: 316
title: Stability of Modular Inverse Sequence
question_type: 数学
domain: 高中数学竞赛数论
difficulty: 中学
knowledge_point: 数论：同余方程的解的遗传性
batch: 01_第一批100题
teacher: zhuyoupeng
---

## 题目
Given a sequence $\{a_n\}$ satisfying: $a_n$ is the smallest positive integer such that $31a_n + 1$ is divisible by $2^n$. Define the set $M = \{n \in \mathbb{Z}^+ \mid 1 \le n \le 500, a_n = a_{n+1}\}$. Find the number of elements in set $M$.

## 解答
Solution

**1. Transform the Condition**
The condition that $31a_n + 1$ is divisible by $2^n$ can be written as the congruence:
$$31a_n \equiv -1 \pmod{2^n}$$
Since $\gcd(31, 2^n) = 1$, a unique solution modulo $2^n$ exists. Given $a_n$ is the smallest positive integer, $0 < a_n < 2^n$.

**2. Analyze the Stability Condition**
We compare $a_n$ and $a_{n+1}$.
$a_{n+1}$ satisfies $31a_{n+1} \equiv -1 \pmod{2^{n+1}}$.
This implies $31a_{n+1} \equiv -1 \pmod{2^n}$ as well.
Since $a_n$ is the unique solution modulo $2^n$ in the range $(0, 2^n)$, and $a_{n+1}$ is a solution in the range $(0, 2^{n+1})$, the relationship between them must be:
$$a_{n+1} = a_n \quad \text{or} \quad a_{n+1} = a_n + 2^n$$
The set $M$ contains $n$ such that $a_{n+1} = a_n$.

**3. Binary Expansion Method**
The sequence $a_n$ essentially represents the partial sums of the binary expansion of the number $x = -1/31$ in the 2-adic integers $\mathbb{Z}_2$.
$$x = \frac{1}{-31} = \frac{1}{1 - 32} = \frac{1}{1 - 2^5}$$
Using the geometric series formula $\frac{1}{1-r} = 1 + r + r^2 + \dots$ (which converges in 2-adic metric for $r=2^5$):
$$x = 1 + 2^5 + 2^{10} + 2^{15} + \dots = \sum_{k=0}^{\infty} 2^{5k}$$
In binary representation, this number has bits equal to 1 at positions $0, 5, 10, 15, \dots$ (indices are $0$-based), and 0 elsewhere.
Let the binary bits of $x$ be $b_0, b_1, b_2, \dots$.
Then $a_n = \sum_{i=0}^{n-1} b_i 2^i$ and $a_{n+1} = \sum_{i=0}^{n} b_i 2^i = a_n + b_n 2^n$.
Therefore, $a_n = a_{n+1}$ if and only if the $n$-th bit $b_n = 0$.

From the series expansion, $b_n = 1$ if and only if $n$ is a multiple of 5 ($n \in \{0, 5, 10, \dots\}$).
Thus, $b_n = 0$ if and only if $n$ is **not** a multiple of 5.

**4. Calculation**
We are looking for the number of integers $n$ in the range $1 \le n \le 500$ such that $n$ is not a multiple of 5.
Total integers = 500.
Multiples of 5 in range: $5, 10, \dots, 500$.
Count of multiples = $\frac{500}{5} = 100$.
Count of non-multiples = $500 - 100 = 400$.

**Alternative Method (Modular Inverse Parity)**
Let $k_n$ be the integer such that $k_n \cdot 2^n \equiv 1 \pmod{31}$. It can be shown that $a_n = a_{n+1} \iff k_n$ is even.
The sequence of powers of 2 mod 31 is $2, 4, 8, 16, 1, \dots$ (period 5).
The sequence of inverses ($k_n$) mod 31 is:
$n=1: 2^{-1} \equiv 16$ (Even)
$n=2: 4^{-1} \equiv 8$ (Even)
$n=3: 8^{-1} \equiv 4$ (Even)
$n=4: 16^{-1} \equiv 2$ (Even)
$n=5: 1^{-1} \equiv 1$ (Odd)
In every 5 consecutive integers, 4 satisfy the condition.
Total = $\frac{500}{5} \times 4 = 400$.



## 答案
400
