---
id: 316
title: Stability of Modular Inverse Sequence
question_type: 数学
domain: 高中数学竞赛数论
difficulty: 中学
knowledge_point: 数论：同余方程的解的遗传性
batch: 01_第一批100题
teacher: zhuyoupeng
---

## 题目
Given a sequence $\{a_n\}$ satisfying: $a_n$ is the smallest positive integer such that $31a_n + 1$ is divisible by $2^n$. Define the set $M = \{n \in \mathbb{Z}^+ \mid 1 \le n \le 500, a_n = a_{n+1}\}$. Find the number of elements in set $M$.

## 解答
Analysis:
1. Model reduction: $31a_n \equiv -1 \pmod{2^n}$. This is equivalent to $a_n$ being the smallest positive residue of $-31^{-1} \pmod{2^n}$.
2. Periodicity determination: Since $31 = 2^5 - 1$, under modulus 31, the smallest positive integer $k$ such that $2^k \equiv 1 \pmod{31}$ is $k=5$.
3. Condition determination: $a_n = a_{n+1}$ is equivalent to $31a_n \equiv -1 \pmod{2^{n+1}}$.
 Let $a_n = \frac{k \cdot 2^n - 1}{31}$. For $a_n = a_{n+1}$ to hold, we must have $31 \mid (k \cdot 2^n - 1)$ and $31 \mid (k \cdot 2^n - 1)$ still holds under modulus $2^{n+1}$.
 In fact, in $k \in \{1, 2, \dots, 31\}$, there is only one $k$ such that $31 \mid k \cdot 2^n - 1$.
 Let this value be $k_n$. Then $a_n = \frac{k_n 2^n - 1}{31}$.
 $a_{n+1} = a_n \iff$ the corresponding numerator part of $k_n 2^n - 1$ divisible by a multiple of $2^{n+1}$ (i.e., $31 \cdot 2^{n+1}$) is equal.
 Simplified conclusion: $a_n = a_{n+1}$ if and only if $k_n$ is even.
4. Cycle analysis: $k_n \cdot 2^n \equiv 1 \pmod{31}$.
 When $n=1, 2, 3, 4, 5$:
 ◦ $n=1: 2k_1 \equiv 1 \equiv 32 \implies k_1 = 16$ (even)
 ◦ $n=2: 4k_2 \equiv 1 \equiv 33 \equiv 64 \implies k_2 = 16$ (even)
 ◦ $n=3: 8k_3 \equiv 1 \equiv 65 \equiv 128 \implies k_3 = 16$ (even)
 ◦ $n=4: 16k_4 \equiv 1 \equiv 17 \equiv 48 \implies k_4 = 3$ (odd)
 ◦ $n=5: 32k_5 \equiv k_5 \equiv 1 \implies k_5 = 1$ (odd)
 The period is 5. In one period, the number of times $k_n$ is even is 3 (when $n=1, 2, 3$).
5. Counting: $500 = 100 \times 5$. The total number is $100 \times 3 = 300$.

## 答案
300
