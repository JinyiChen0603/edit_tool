---
id: 306
title: Lines in 3D Lattice Grid
question_type: 数学
domain: 高中数学竞赛组合
difficulty: 中学
knowledge_point: 空间解析几何：离散格点计数
batch: 01_第一批100题
teacher: zhuyoupeng
---

## 题目
Consider the set of points $S = \{(x, y, z) \mid x, y, z \in \{1, 2, \dots, 7\}\}$ in three - dimensional space. These points form a cube grid with a side length of 7. Find the total number of distinct lines that pass through this set of points and contain exactly 4 points.

## 解答

1. Problem Analysis and Definition
We need to find the number of lines $L$ satisfying the following two conditions:
   Geometric Constraint: Line $L$ passes through at least two points in the point set $S$ (thus uniquely determined).
   Counting Constraint: The intersection of line $L$ with point set $S$ has exactly size 4, i.e., $|L \cap S| = 4$.
Let the direction vector of the line be $\vec{v} = (a, b, c)$, where $a, b, c \in \mathbb{Z}$, and $\gcd(a, b, c) = 1$ (being coprime ensures we count every integer lattice point on the line without skipping).
If a line in the grid contains exactly 4 points, these 4 points constitute a "span". Let these 4 points be $P_0, P_1, P_2, P_3$, then $P_3 - P_0 = 3\vec{v}$.
Since the coordinate range of the point set $S$ is $[1, 7]$, the maximum span is $7-1=6$. Therefore, each component of the direction vector must satisfy:
$$ |3a| \le 6, |3b| \le 6, |3c| \le 6 $$
Thus, the components of the direction vector $a, b, c \in \{0, 1, 2\}$.
We will classify based on the absolute values of the components of the direction vector $\vec{v}$. To avoid duplicate counting, we first classify by unordered absolute value tuples $(|a|, |b|, |c|)$, and then calculate the permutations and sign variations for each class.
2. Classification Counting
Case 1: Direction vector absolute values are $(1, 0, 0)$
   Representative Direction: Parallel to coordinate axes, e.g., $(1, 0, 0)$.
   Analysis: Taking direction $(1, 0, 0)$ as an example, the line equation is $y=y_0, z=z_0$.
    The $x$-coordinates on this line take values $1, 2, \dots, 7$.
    Clearly, the intersection of this line with set $S$ contains 7 points.
   Result: $7 \neq 4$, does not meet the problem requirement.
   Count: 0.
Case 2: Direction vector absolute values are $(1, 1, 0)$
   Representative Direction: Face diagonal directions.
   Geometric Feature: The projection of the line on a 2D plane is a line with slope $\pm 1$, and the third coordinate is fixed.
   Counting:
    In a $7 \times 7$ planar grid, we need to find lines $y = x + k$ that contain exactly 4 points.
       If the line contains 1, 2, 3, 4, then $k=3$ (points are $(1,4) \dots (4,7)$).
       If the line contains 4, 5, 6, 7, then $k=-3$ (points are $(4,1) \dots (7,4)$).
       Lines corresponding to other intercepts contain 5, 6, or 7 points, which do not fit.
      Therefore, there are 2 lines with slope $+1$ and 2 lines with slope $-1$ in each 2D plane, totaling 4 lines.
   Total Space:
       Number of directions: 3 types of planes ($xy, yz, xz$).
       Number of layers: Each type of plane has 7 layers (e.g., the $xy$ plane has $z=1 \dots 7$).
       Calculation: $3 \text{ (directions)} \times 7 \text{ (layers)} \times 4 \text{ (lines per layer)} = 84$.
   Count: 84.
Case 3: Direction vector absolute values are $(1, 1, 1)$
   Representative Direction: Space diagonal (body diagonal) directions.
   Geometric Feature: $x, y, z$ change simultaneously with step size 1.
   Counting:
    We need to find starting points $P(x,y,z)$ such that the sequence $P, P+\vec{v}, P+2\vec{v}, P+3\vec{v}$ is inside the cube, and the predecessor point $P-\vec{v}$ and successor point $P+4\vec{v}$ are outside the cube.
    This means the line must be "pushed" against the boundary of the cube and extend 3 units.
    For a $7 \times 7 \times 7$ cube, the number of body diagonals satisfying $|L \cap S| = 4$ is calculated as follows:
    Let the direction be $(1,1,1)$, this type of line is determined by the starting point $(x,y,z)$, requiring:
       $x, y, z \in \{1, 2, 3, 4\}$ (ensuring 4 points are inside).
       $\min(x,y,z) = 1$ (starting point on boundary, no predecessor).
       $\max(x,y,z) = 4$ (ending point on boundary, no successor).
    Using the Principle of Inclusion-Exclusion or set counting:
       Universal set $U = \{1,2,3,4\}^3$, size $4^3=64$.
       Condition A ($\min=1$): Exclude $\{2,3,4\}^3$ ($3^3=27$) $\to |A| = 64 - 27 = 37$.
       Condition B ($\max=4$): We want $A \cap B$.
      $A \cap B = A \setminus \{ \text{points with all components} \le 3 \} = A \setminus \{1,2,3\}^3$.
      However, the size of the set in $\{1,2,3\}^3$ satisfying $\min=1$ is $3^3 - 2^3 = 27 - 8 = 19$.
       Number of valid lines $= 37 - 19 = 18$.
   Total Space: Body diagonals have 4 directions (different sign combinations of $(\pm 1, \pm 1, \pm 1)$).
       Calculation: $18 \times 4 = 72$.
   Count: 72.
Case 4: Direction vector absolute values are $(1, 2, 0)$
   Representative Direction: Lines with slope 2 or 1/2 within a plane.
   Geometric Feature: One component constant, one changes by 1, one changes by 2.
   Counting:
       Step analysis: The component with the largest change has a step size of 2. To accommodate 4 points (3 intervals), the total span of this component is $3 \times 2 = 6$.
       Within the range $[1, 7]$, a span of 6 implies the coordinate must go from 1 to 7 (unique path). For example, the $y$ coordinates must be $\{1, 3, 5, 7\}$.
       The component with step size 1 (let it be $x$): Needs to accommodate 4 consecutive points within a length of 7, so there are 4 possible starting positions $(1, 2, 3, 4)$.
       The component with step size 0 (let it be $z$): Can be any layer $1 \dots 7$.
       Number of lines for a single specific direction (e.g., $\vec{v}=(1,2,0)$): $1 \text{ (y fixed)} \times 4 \text{ (x sliding)} \times 7 \text{ (z layers)} = 28$.
   Total Space:
       Number of directions:
         Permutations of components: $(1,2,0), (2,1,0), (1,0,2) \dots$, totaling 6 permutations.
         Signs: For non-zero components $(1, 2)$, there are 2 relative sign choices (same sign or opposite sign, lines are undirected).
         Total direction categories: $6 \times 2 = 12$.
       Calculation: $28 \times 12 = 336$.
   Count: 336.
Case 5: Direction vector absolute values are $(1, 2, 1)$
   Representative Direction: Space oblique lines.
   Geometric Feature: $\Delta x = 3, \Delta y = 6, \Delta z = 3$.
   Counting:
       Component with step size 2 (span 6): Must be fixed as $\{1, 3, 5, 7\}$ (1 option).
       Component with step size 1 (span 3): 4 positions.
       Component with step size 1 (span 3): 4 positions.
       Number of lines for a single specific direction: $1 \times 4 \times 4 = 16$.
   Total Space:
       Number of directions:
         Permutations of components: $(1,1,2), (1,2,1), (2,1,1)$, totaling 3.
         Signs: All three components are non-zero; based on $(1,1,2)$, there are 4 sign combinations (+++, ++-, +-+, +--).
         Total direction categories: $3 \times 4 = 12$.
       Calculation: $16 \times 12 = 192$.
   Count: 192.
Case 6: Direction vector absolute values are $(1, 2, 2)$
   Representative Direction: Space oblique lines.
   Geometric Feature: $\Delta x = 3, \Delta y = 6, \Delta z = 6$.
   Counting:
       Component with step size 2 (span 6): Fixed 1 option.
       Component with step size 2 (span 6): Fixed 1 option.
       Component with step size 1 (span 3): 4 sliding options.
       Number of lines for a single specific direction: $1 \times 1 \times 4 = 4$.
   Total Space:
       Number of directions:
         Permutations of components: $(1,2,2), (2,1,2), (2,2,1)$, totaling 3.
         Signs: 4 options.
         Total direction categories: $3 \times 4 = 12$.
       Calculation: $4 \times 12 = 48$.
   Count: 48.
(Note: No other coprime combinations with component absolute values $\le 2$ exist. E.g., $(2,2,2)$ simplifies to $(1,1,1)$; $(0,2,2)$ simplifies to $(0,1,1)$.)
3. Summary of Results
Adding up the counts from all the above cases:
| Direction Vector Type | Formula | Count |
|---|---|---|
| $(1, 0, 0)$ | 0 | 0 |
| $(1, 1, 0)$ | $3 \times 7 \times 4$ | 84 |
| $(1, 1, 1)$ | $4 \times 18$ | 72 |
| $(1, 2, 0)$ | $12 \times 28$ | 336 |
| $(1, 2, 1)$ | $12 \times 16$ | 192 |
| $(1, 2, 2)$ | $12 \times 4$ | 48 |
| Total |  | 732 |
Answer
732

## 答案
732
