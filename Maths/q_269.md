---
id: 269
title: Clockwise Relay with a Global Type–State Swap
question_type: 数学
domain: 高中数学竞赛组合
difficulty: 中学
knowledge_point: Cyclic permutation / rotation operator on a labeled directed cycle
Order of a permutation and return times (periodicity)
Functional equation on binary strings: a shift equals the bitwise complement
Orbit decomposition under a fixed step rotation (gcd/cycle structure)
Counting binary assignments forced by alternation constraints along cycles
batch: 01_第一批100题
teacher: xieshuhong
---

## 题目
There are $(4016)$ labeled terminals arranged on a directed ring, numbered $(0,1,\dots,4015)$ clockwise (indices taken modulo $(4016)$). Each terminal is occupied by exactly one operator, and every operator is of exactly one of two types:

Type A (exactly $(2008)$ operators),
Type B (exactly $(2008)$ operators).

Each operator holds exactly one token. There are two token colors, White and Black, and initially:

every Type A operator holds a White token,
every Type B operator holds a Black token.

A round consists of the following simultaneous action: every operator passes the token they are currently holding to the next terminal clockwise (i.e., from terminal $(i)$ to terminal $(i+1)$ modulo $(4016)$).
A seating (i.e., an assignment of operator types to terminals) is called swap-feasible if there exists a positive integer $(t)$ such that after exactly $(t)$ rounds:

every Type A operator holds a Black token, and
every Type B operator holds a White token.

Operators of the same type are considered indistinguishable; only which terminals are Type A vs Type B matters.
Question. How many swap-feasible seatings are there?

## 解答
We encode a seating by a binary string on the $4016$ labeled terminals:

$x_i=0$ means terminal $i$ hosts Type A (initial token = White), $x_i=1$ means terminal $i$ hosts Type B (initial token = Black).

Because tokens are passed one step clockwise each round, after $t$ rounds the token sitting at terminal $i$ is exactly the token that started at terminal $i-t$ (indices mod $4016$).

1) Two global states
Let:

Original state: “Type A holds White and Type B holds Black” — this is true at time $0$.
Good state: “Type A holds Black and Type B holds White”.

If at time $t$ the system is in the good state, then the token at terminal $i$ must be the opposite of what the type at $i$ initially had. Since the initial token color is determined by the type, the condition “good at time $t$” translates to:

the token arriving to each terminal $i$ after $t$ rounds must be the opposite of the token that would correspond to the type currently sitting at $i$.

But the token at $i$ after $t$ rounds comes from terminal $(i-t)$ initially, whose initial token color depends on $x_{i-t}$. Flipping White/Black corresponds exactly to flipping (0/1). Hence the “good state after $t$ rounds” condition is:
$$
x_{i-t} = 1 - x_i \quad \text{for all } i \ (\text{mod }4016).
$$
Equivalently,
$$
x_{i+t} = 1 - x_i \quad \text{for all } i.
$$
So the problem is: count binary strings ($x_0,\dots,x_{4015}$) satisfying the above for some positive $t$.

2) Minimal time ($d$) and the “倍数性” lemma
Assume the seating is swap-feasible, and let $d$ be the smallest positive integer such that the good state occurs after $d$ rounds. Then:

After another $d$ rounds (total $2d$), the types should again match the original token colors, i.e. the system returns to the original state.

This is immediate from the equation: applying the rule twice gives a double flip:
From
$$
x_{i+d} = 1 - x_i,
$$
shift indices by $d$:
$$
x_{i+2d} = 1 - x_{i+d} = 1 - (1-x_i) = x_i.
$$
So after $2d$ rounds the entire configuration returns to the original state.
Let $a$ be the smallest positive integer such that after $a$ rounds the system returns to the original state (i.e. $x_{i+a}=x_i$ for all $i$). Then the system returns to the original state after exactly $b$ rounds iff $b$ is a multiple of $a$.
Proof sketch (standard minimal-period argument).
If $b=ma+k$ with $0\le k<a$, then “after $ma$ rounds” is original again, so the state after $b$ rounds equals the state after $k$ rounds. If $k>0$, that would mean we return to original in fewer than $a$ rounds, contradicting minimality. Thus $k=0$, so $a\mid b$. ∎
In our setting, $2d$ is a return time to the original state. Also, because $d$ was chosen as the first time to reach the good state, one can check there is no smaller positive return time than $2d$; thus the “first return to original” time is exactly $2d$. (This is the same contradiction step as in the original write-up: if an earlier return existed, it would force a good state earlier than $d$.)
Therefore:

Original state occurs exactly at multiples of $2d$;
Good state occurs exactly at odd multiples of $d$ (i.e. $d,3d,5d,\dots$).

3) Forcing $2d$ to divide $4016$
No matter what the seating is, after $4016$ rounds every token has moved around the full ring and returns to its starting terminal. Hence the entire token distribution is exactly as at time $0$, i.e. the system is in the original state after $4016$ rounds.
So $4016$ is a return time to original. By the lemma and the fact that the minimal return time is $2d$, we must have:
$$
2d \mid 4016.
$$
Since $4016=2^4\cdot 251$, the possible values of $d$ are:
$$
d \in \{1,2,4,8,251,502,1004,2008\}.
$$
Now a key pruning (again mirroring the original solution):

If $d=1$, then the good state occurs at time $251$ as well (since $251$ is an odd multiple of $1$).
If $d=2$, then the good state occurs at time $502$.
If $d=4$, then the good state occurs at time $1004$.
If $d=8$, then the good state occurs at time $2008$.

So every swap-feasible seating will achieve the good state after
$$
n \in \{251,502,1004,2008\}
$$
rounds for at least one such $n$. Moreover, by the lemma/minimality argument, counting seatings by the first time they reach the good state avoids overcounting, and it is enough to count seatings that reach the good state after one of these four times.
Thus, it suffices to compute, for each
$$
n \in \{251,502,1004,2008\},
$$
the number of seatings satisfying
$$
x_{i+n}=1-x_i \ \text{for all } i.
$$

4) Counting solutions for a fixed $n$
Fix such an $n$. Consider the map $i \mapsto i+n \pmod{4016}$. This partitions the set of terminals into cycles (orbits). Along each orbit, the constraint
$$
x_{i+n}=1-x_i
$$
forces an alternating pattern. Applying it twice yields:
$$
x_{i+2n}=x_i.
$$
So along each orbit of step $2n$, values repeat; and along a step $n$ move, values flip.
Now, because $4016$ is divisible by $2n$ for each $n\in\{251,502,1004,2008\}$, the sequence
$i,\ i+n,\ i+2n,\ \dots$
returns to $i$ after an even number of $n$-steps, so no contradiction occurs (we don’t get $x_i=1-x_i$). In fact, one can show the terminals split into exactly $n$ independent “paired chains”, and specifying the types on a well-chosen set of $n$ terminals determines all others uniquely.
A clean way to see the degrees of freedom:

Choose representatives $(0,1,2,\dots,n-1)$.
For any $r \in \{0,1,\dots,n-1\}$, the constraints determine uniquely:

$$
x_{r+n}=1-x_r,\quad x_{r+2n}=x_r,\quad x_{r+3n}=1-x_r,\ \dots
$$
Thus the entire orbit generated from $r$ is forced once $x_r$ is chosen. Different $r$’s produce disjoint orbits, and together they cover all $4016$ terminals.
Therefore, the number of solutions for this fixed $n$ is exactly:
$$
2^n.
$$
(Each of the $n$ representatives can be chosen as $0$ or $1$, and then everything else is forced.)

5) Final count
From the discussion above, the valid seatings arise precisely from the cases
$$
n \in \{251,502,1004,2008\},
$$
and for each such $n$ there are $2^n$ seatings.
Hence the total number of swap-feasible seatings is:
$$
2^{251}+2^{502}+2^{1004}+2^{2008}.
$$

(Optional sanity check) Equal numbers of Type A and Type B
Any solution of $x_{i+n}=1-x_i$ pairs terminals ($i$) and ($i+n$) into opposite types, so exactly half are $0$ and half are $1$. Thus the condition “$2008$ Type A and $2008$ Type B” is automatically satisfied for these solutions—consistent and nicely self-checking.

## 答案
$$2^{251}+2^{502}+2^{1004}+2^{2008}$$
