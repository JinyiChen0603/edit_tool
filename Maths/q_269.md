---
id: 269
title: Clockwise Relay with a Global Type–State Swap
question_type: 数学
domain: 高中数学竞赛组合
difficulty: 中学
knowledge_point: Cyclic permutation / rotation operator on a labeled directed cycle
batch: 01_第一批100题
teacher: xieshuhong
---

## 题目
There are $(4016)$ labeled terminals arranged on a directed ring, numbered $(0,1,\dots,4015)$ clockwise (indices taken modulo $(4016)$). Each terminal is occupied by exactly one operator, and every operator is of exactly one of two types:

Type A (exactly $(2008)$ operators),
Type B (exactly $(2008)$ operators).

Each operator holds exactly one token. There are two token colors, White and Black, and initially:

every Type A operator holds a White token,
every Type B operator holds a Black token.

A round consists of the following simultaneous action: every operator passes the token they are currently holding to the next terminal clockwise (i.e., from terminal $(i)$ to terminal $(i+1)$ modulo $(4016)$).
A seating (i.e., an assignment of operator types to terminals) is called swap-feasible if there exists a positive integer $(t)$ such that after exactly $(t)$ rounds:

every Type A operator holds a Black token, and
every Type B operator holds a White token.

Operators of the same type are considered indistinguishable; only which terminals are Type A vs Type B matters.
Question. How many swap-feasible seatings are there?

## 解答

1. Mathematical Formulation
Let $N = 4016$ be the number of terminals. We can represent the arrangement of operators as a binary sequence $x = (x_0, x_1, \dots, x_{N-1})$, where:

$x_i = 0$ if the operator at terminal $i$ is Type A (initially holds White).
$x_i = 1$ if the operator at terminal $i$ is Type B (initially holds Black).

The problem states there are $N/2 = 2008$ operators of each type. Thus, the sequence $x$ must satisfy the weight constraint:
$$ \sum_{i=0}^{N-1} x_i = \frac{N}{2} = 2008 $$
The Swap-Feasible Condition:
After $t$ rounds, the token currently at terminal $i$ originated from the operator at terminal $i-t$ (indices taken modulo $N$).

Type A operators (at positions where $x_i = 0$) must end up with Black tokens (which originate from Type B, where $x_{i-t} = 1$).
Type B operators (at positions where $x_i = 1$) must end up with White tokens (which originate from Type A, where $x_{i-t} = 0$).

This implies that for a valid seating, there must exist an integer $t$ such that for all $i$:
$$ x_i = 0 \implies x_{i-t} = 1 $$
$$ x_i = 1 \implies x_{i-t} = 0 $$
Combining these, we require $x_i \neq x_{i-t}$ for all $i$. By substituting $j = i-t$, this is equivalent to requiring $x_{j+t} \neq x_j$ for all $j$.
Thus, a seating $x$ is swap-feasible if and only if there exists an integer $t$ such that:
$$ x_{i+t} = 1 - x_i \quad \text{for all } i \in {0, \dots, N-1} $$
This condition defines $x$ as an anti-periodic string with anti-period $t$.

2. Recursive Analysis
Let $S_L$ be the set of valid binary strings of length $L$ with equal numbers of 0s and 1s that admit an anti-period $t$. We want to find $|S_{4016}|$.
Consider a string $x$ of even length $L$. We check if it admits the specific anti-period $t = L/2$.
The condition $x_{i + L/2} \neq x_i$ divides the set of all balanced strings into two disjoint cases based on the symmetry with respect to the shift $L/2$:
Case 1: The string is anti-periodic with $t = L/2$.
This means $x_{i + L/2} = 1 - x_i$ for all $0 \le i < L/2$.
The string is fully determined by its first half, $y = (x_0, \dots, x_{L/2 - 1})$. The second half is the bitwise negation of $y$.

The number of 1s in the full string $x$ is (number of 1s in $y$) + (number of 1s in $\bar{y}$).
Let $k$ be the weight of $y$. The weight of $\bar{y}$ is $L/2 - k$.
Total weight of $x$ is $k + (L/2 - k) = L/2$.
This means any binary string $y$ of length $L/2$ generates a valid balanced string $x$ in this case.
Number of solutions in this case: $2^{L/2}$.

Case 2: The string is periodic with period $L/2$.
This means $x_{i + L/2} = x_i$ for all $i$.
For $x$ to be swap-feasible, it must admit some other anti-period $t' \neq L/2$.

Since $x$ consists of two identical copies of a substring $y$ of length $L/2$ (i.e., $x = yy$), the condition $x_{i+t'} \neq x_i$ on $x$ reduces to the same condition on $y$ (modulo $L/2$).
Therefore, $x$ is feasible if and only if $y$ is a feasible string of length $L/2$.
Weight Constraint: For $x$ to have weight $L/2$, the substring $y$ must have weight $L/4$.
Thus, we need to count the number of feasible strings of length $L/2$ with exactly half 1s and half 0s. This is exactly the definition of the problem for size $L/2$.

Recurrence Relation:
Let $A(L)$ be the number of swap-feasible seatings of length $L$ (where $L$ is even and we require $L/2$ operators of each type).
$$ A(L) = 2^{L/2} + A(L/2) $$
Base Case:
The recursion continues as long as the length is even. If we reach an odd length $L_{odd}$, an anti-periodic string is impossible.
Proof: If $x_{i+t} \neq x_i$ for an odd length $L$, consider the cycle generated by adding $t$ modulo $L$. Since $L$ is odd, the subgroup generated by $t$ covers the entire group (or disjoint cycles of odd length). Traversing an odd cycle requires alternating values ($0 \to 1 \to 0 \dots$), which is impossible to close consistently (requires $0 \neq 0$).
Thus, $A(L_{odd}) = 0$.

3. Calculation
We apply the recurrence starting with $N = 4016$:


Step 1 ($L=4016$):
$$ A(4016) = 2^{2008} + A(2008) $$


Step 2 ($L=2008$):
$$ A(2008) = 2^{1004} + A(1004) $$


Step 3 ($L=1004$):
$$ A(1004) = 2^{502} + A(502) $$


Step 4 ($L=502$):
$$ A(502) = 2^{251} + A(251) $$


Step 5 ($L=251$):
Since 251 is odd, no swap-feasible seatings exist.
$$ A(251) = 0 $$


Summing up:
Substituting back up the chain:
$$ A(4016) = 2^{2008} + 2^{1004} + 2^{502} + 2^{251} + 0 $$
Conclusion
The total number of swap-feasible seatings is:
$$ 2^{2008} + 2^{1004} + 2^{502} + 2^{251} $$

## 答案
$$2^{251}+2^{502}+2^{1004}+2^{2008}$$
